async function fetchData() {
  try {
      const response = await axios.get('https://www.pneub2b.eu/PartnerCommunication.ashx?cmd=business_analytics', {
          auth: {
              username: '1608', // Vaše uživatelské jméno
              password: 'Qar6wETkAj0ocQj' // Vaše heslo
          },
          responseType: 'text'
      });

      return response.data;
  } catch (error) {
      console.error('Error fetching data:', error);
      throw error;
  }
}

async function parseXML(xml) {
  try {
      const result = await parser.parseStringPromise(xml);
      // Zde extrahujeme produkty z XML dat, předpokládáme specifickou strukturu
      // Například, pokud máte XML strukturu podobnou ukázce, upravte cestu k datům podle vašich potřeb
      return result.Response.Tyres[0].Tyre.map(tyre => ({
          ProductID: tyre.ID[0],
          ProductName: tyre.DisplayName[0],
          // Přidejte další políčka podle vašich potřeb
      }));
  } catch (error) {
      console.error('Error parsing XML:', error);
      throw error;
  }
}

function clearProductsTable() {
  return new Promise((resolve, reject) => {
      pool.query('TRUNCATE TABLE B2B_BA_Products', (error, results) => {
          if (error) {
              reject(error);
          } else {
              console.log('Products table cleared');
              resolve(results);
          }
      });
  });
}

function insertProduct(product) {
  return new Promise((resolve, reject) => {
      const sql = 'INSERT INTO B2B_BA_Products (ProductID, ProductName) VALUES (?, ?)';
      const values = [product.ProductID, product.ProductName];
      pool.query(sql, values, (error, results) => {
          if (error) {
              reject(error);
          } else {
              console.log(`Product inserted with ID: ${product.ProductID}`);
              resolve(results);
          }
      });
  });
}

async function updateProducts() {
  try {
      const xmlData = await fetchData();
      const products = await parseXML(xmlData);
      await clearProductsTable();
      for (const product of products) {
          await insertProduct(product);
      }
      console.log('All products have been updated.');
  } catch (error) {
      console.error('An error occurred during the update process:', error);
  }
}

updateProducts();

async function updateProducts() {
  try {
      const xmlData = await fetchData();
      const products = await parseXML(xmlData);
      await clearProductsTable();
      for (const product of products) {
        await insertProduct(product);
      }
      console.log('All products have been updated.');
  } catch (error) {
      console.error('An error occurred during the update process:', error);
  }
}
updateProducts();